<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: viz-prior-posterior</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-17', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <h1 class="title"></h1>
          <h1 id="데이터-과학">데이터 과학</h1>
<h2 id="전후-변화">1. 전후 변화</h2>
<p>전후 변화를 시각적으로 나타내는 비교하는 것이 의미가 있는 경우가 크다. 예를 들어, 대선전후 대통령 득표율과 현재 정당지지율 변화를 시각화해보자.</p>
<h3 id="데이터-가져오기">1.1. 데이터 가져오기</h3>
<p>나무위키 웹사이트 <a href="https://namu.wiki/w/%EC%A0%9C19%EB%8C%80%20%EB%8C%80%ED%86%B5%EB%A0%B9%20%EC%84%A0%EA%B1%B0">제19대 대통령 선거</a> 웹사이트에서 대통령 선거에서 얻은 득표와 득표율 데이터을 긁어와서 이를 기준 지지율 정보를 삼는다.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co"># 0. 환경설정 -------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="co">#library(rvest)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="co">#library(tidyverse)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="co">#library(stringr)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="co">#library(extrafont)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="co">#library(ggthemes)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="co">#library(readxl)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="co">#library(reshape2)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="co">#library(RColorBrewer)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="co">#loadfonts()</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a><span class="co"># 1. 데이터 가져오기 -------------------------------------</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a><span class="co">## 1.1. 대선 득표율 --------------------------------------</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>namu_url &lt;-<span class="st"> &quot;https://namu.wiki/w/%EC%A0%9C19%EB%8C%80%20%EB%8C%80%ED%86%B5%EB%A0%B9%20%EC%84%A0%EA%B1%B0&quot;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>namu_html &lt;-<span class="st"> </span><span class="kw">read_html</span>(namu_url, <span class="dt">encoding=</span><span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a><span class="co"># Sys.setlocale(&quot;LC_ALL&quot;, &quot;Korean&quot;)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>gallop_tbl &lt;-<span class="st"> </span><span class="kw">html_table</span>(namu_html, <span class="dt">fill=</span><span class="ot">TRUE</span>) [[<span class="dv">7</span>]] <span class="co"># 7번표 6. 여론조사 </span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>vote_tbl &lt;-<span class="st"> </span><span class="kw">html_table</span>(namu_html, <span class="dt">fill=</span><span class="ot">TRUE</span>) [[<span class="dv">18</span>]] <span class="co"># 18번표 투표율</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>earned_vote_tbl &lt;-<span class="st"> </span><span class="kw">html_table</span>(namu_html, <span class="dt">fill=</span><span class="ot">TRUE</span>) [[<span class="dv">23</span>]] <span class="co"># 23번표 후보별 득표율</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>earned_vote_region_tbl &lt;-<span class="st"> </span><span class="kw">html_table</span>(namu_html, <span class="dt">fill=</span><span class="ot">TRUE</span>) [[<span class="dv">25</span>]]  <span class="co"># 25번표 후보별 상세득표율</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a><span class="co"># write_csv(gallop_tbl,&quot;data/gallop_tbl.csv&quot;)</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a><span class="co"># write_csv(vote_tbl, &quot;data/vote_tbl.csv&quot;)</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a><span class="co"># write_csv(earned_vote_tbl, &quot;data/earned_vote_tbl.csv&quot;)</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a><span class="co"># write_csv(earned_vote_region_tbl, &quot;data/earned_vote_region_tbl.csv&quot;)</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a><span class="co">## 1.2. 정당 지지율 --------------------------------------</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>gallop_dat &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/갤럽_20170623.csv&quot;</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a><span class="co"># 2. 데이터 정제 -------------------------------------</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a>gallop_tbl  &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/gallop_tbl.csv&quot;</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>votes_tbl  &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/vote_tbl.csv&quot;</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>, <span class="dt">skip=</span><span class="dv">3</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>votes_pcnt_tbl &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/earned_vote_tbl.csv&quot;</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>, <span class="dt">skip=</span><span class="dv">3</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>votes_region_tbl &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/earned_vote_region_tbl.csv&quot;</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>, <span class="dt">skip=</span><span class="dv">5</span>)</span></code></pre></div>
<h3 id="데이터-가공">1.2. 데이터 가공</h3>
<p>웹에서 긁어온 데이터를 R에서 데이터 분석과 시각화가 가능한 형태로 데이터프레임으로 가공하는 작업을 수행한다.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>득표율_df &lt;-<span class="st"> </span>votes_pcnt_tbl <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="st">&quot;기호&quot;</span> =<span class="st"> </span>X1,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>                                 <span class="st">&quot;후보&quot;</span> =<span class="st"> </span>X2,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>                                 <span class="st">&quot;정당&quot;</span> =<span class="st"> </span>X3,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>                                 <span class="st">&quot;득표수&quot;</span> =<span class="st"> </span>X4,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>                                 <span class="st">&quot;득표율&quot;</span> =<span class="st"> </span>X5,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>                                 <span class="st">&quot;순위&quot;</span> =<span class="st"> </span>X6,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>                                 <span class="st">&quot;당선여부&quot;</span> =<span class="st"> </span>X7) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(기호 <span class="op">!=</span><span class="st"> </span><span class="dv">11</span>,  기호 <span class="op">!=</span><span class="st"> </span><span class="dv">13</span>, 기호 <span class="op">!=</span><span class="st">&quot;선거인수&quot;</span>, 기호 <span class="op">!=</span><span class="st"> &quot;무효표수&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(득표수 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(득표수, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>)),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>         득표율 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(득표율, <span class="st">&quot;%&quot;</span>, <span class="st">&quot;&quot;</span>    ))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(후보 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;문재인&quot;</span>, <span class="st">&quot;홍준표&quot;</span>, <span class="st">&quot;안철수&quot;</span>, <span class="st">&quot;유승민&quot;</span>, <span class="st">&quot;심상정&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(후보 =<span class="st"> </span><span class="kw">factor</span>(후보, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;문재인&quot;</span>, <span class="st">&quot;홍준표&quot;</span>, <span class="st">&quot;안철수&quot;</span>, <span class="st">&quot;유승민&quot;</span>, <span class="st">&quot;심상정&quot;</span>)))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>시도득표수_df &lt;-<span class="st"> </span>votes_region_tbl <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">rename</span>(시도 =<span class="st"> </span>X1,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>                                   문재인 =<span class="st"> </span>X2,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a>                                   홍준표 =<span class="st"> </span>X3,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a>                                   안철수 =<span class="st"> </span>X4,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a>                                   유승민 =<span class="st"> </span>X5,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>                                   심상정 =<span class="st"> </span>X6) <span class="op">%&gt;%</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(문재인 =<span class="st"> </span><span class="kw">strsplit</span>(문재인, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>), </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>         홍준표 =<span class="st"> </span><span class="kw">strsplit</span>(홍준표, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a>         안철수 =<span class="st"> </span><span class="kw">strsplit</span>(안철수, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>), </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a>         유승민 =<span class="st"> </span><span class="kw">strsplit</span>(유승민, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>), </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a>         심상정 =<span class="st"> </span><span class="kw">strsplit</span>(심상정, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>(문재인, 홍준표, 안철수, 유승민, 심상정) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="kw">row_number</span>(시도) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(문재인 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(문재인, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>)),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true"></a>         홍준표 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(홍준표, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>)),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true"></a>         안철수 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(안철수, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>)),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true"></a>         유승민 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(유승민, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>)),</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true"></a>         심상정 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(심상정, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>)))</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true"></a>  </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true"></a>시도득표율_df &lt;-<span class="st"> </span>votes_region_tbl <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">rename</span>(시도 =<span class="st"> </span>X1,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true"></a>                                                문재인 =<span class="st"> </span>X2,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true"></a>                                                홍준표 =<span class="st"> </span>X3,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true"></a>                                                안철수 =<span class="st"> </span>X4,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true"></a>                                                유승민 =<span class="st"> </span>X5,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true"></a>                                                심상정 =<span class="st"> </span>X6) <span class="op">%&gt;%</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(문재인 =<span class="st"> </span><span class="kw">strsplit</span>(문재인, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>), </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true"></a>            홍준표 =<span class="st"> </span><span class="kw">strsplit</span>(홍준표, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>),</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true"></a>            안철수 =<span class="st"> </span><span class="kw">strsplit</span>(안철수, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>), </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true"></a>            유승민 =<span class="st"> </span><span class="kw">strsplit</span>(유승민, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>), </span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true"></a>            심상정 =<span class="st"> </span><span class="kw">strsplit</span>(심상정, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">(&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true"></a><span class="st">  </span><span class="kw">unnest</span>(문재인, 홍준표, 안철수, 유승민, 심상정) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="kw">row_number</span>(시도) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(문재인 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(문재인, <span class="st">&quot;%|</span><span class="ch">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>)),</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true"></a>         홍준표 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(홍준표, <span class="st">&quot;%|</span><span class="ch">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>)),</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true"></a>         안철수 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(안철수, <span class="st">&quot;%|</span><span class="ch">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>)),</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true"></a>         유승민 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(유승민, <span class="st">&quot;%|</span><span class="ch">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>)),</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true"></a>         심상정 =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(심상정, <span class="st">&quot;%|</span><span class="ch">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>)))</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true"></a>gallop_df &lt;-<span class="st"> </span>gallop_dat <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(더불어민주당 =<span class="st"> </span>민주당, 자유한국당, 국민의당, 바른정당, 정의당) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate_if</span>(is.character, as.numeric)</span></code></pre></div>
<pre class="output"><code>Warning in eval(substitute(expr), envir, enclos): NAs introduced by
coercion

Warning in eval(substitute(expr), envir, enclos): NAs introduced by
coercion

Warning in eval(substitute(expr), envir, enclos): NAs introduced by
coercion

Warning in eval(substitute(expr), envir, enclos): NAs introduced by
coercion

Warning in eval(substitute(expr), envir, enclos): NAs introduced by
coercion
</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>gallop_df &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(시도=gallop_dat<span class="op">$</span>시도), gallop_df)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="co"># 3. 데이터 병합 -------------------------------------</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>current_df &lt;-<span class="st"> </span>gallop_df <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(시도 <span class="op">==</span><span class="st"> &quot;전체&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(정당, 정당지지율, <span class="op">-</span>시도) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>시도)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>past_df &lt;-<span class="st"> </span>득표율_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(득표율 =<span class="st"> </span>득표율 <span class="op">/</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(정당, 대선지지율 =<span class="st"> </span>득표율)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>정당지지율_df &lt;-<span class="st"> </span><span class="kw">inner_join</span>(past_df, current_df, <span class="dt">by=</span><span class="st">&quot;정당&quot;</span>)</span></code></pre></div>
<h3 id="시각화">1.3. 시각화</h3>
<p>갤럽에서 최근(6월23일)에 조사한 데이터와 대선 각 후보별 득표율과 정당지지율을 한데 모아 이를 시각화한다.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co"># 3. 시각화 -------------------------------------</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>colors &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>정당지지율_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(정당 =<span class="st"> </span><span class="kw">factor</span>(정당, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;정의당&quot;</span>, <span class="st">&quot;바른정당&quot;</span>, <span class="st">&quot;국민의당&quot;</span>, <span class="st">&quot;자유한국당&quot;</span>, <span class="st">&quot;더불어민주당&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data=</span>., <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(대선지지율, 정당), <span class="dt">y =</span> 대선지지율)) <span class="op">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> 정당지지율_df<span class="op">$</span><span class="st">&quot;대선지지율&quot;</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>                     <span class="dt">y =</span> 정당,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>                     <span class="dt">xend =</span> 정당지지율_df<span class="op">$</span><span class="st">&quot;정당지지율&quot;</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>                     <span class="dt">yend =</span> 정당),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>                     <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> 정당지지율_df<span class="op">$</span><span class="st">&quot;대선지지율&quot;</span>,<span class="dt">y=</span>정당,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>                    <span class="dt">color =</span> <span class="st">&quot;대선지지율&quot;</span>),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>                    <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">15</span>) <span class="op">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> 정당지지율_df<span class="op">$</span><span class="st">&quot;정당지지율&quot;</span>,<span class="dt">y=</span>정당,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>                   <span class="dt">color =</span> <span class="st">&quot;정당지지율&quot;</span>),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>               <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">shape =</span> <span class="dv">15</span>) <span class="op">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a><span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">name =</span> <span class="st">&quot;대선 전후 정당지지율&quot;</span>, <span class="co"># or name = element_blank()</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;대선지지율&quot;</span>, <span class="st">&quot;정당지지율&quot;</span>),</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>                       <span class="dt">values =</span> colors) <span class="op">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent)</span></code></pre></div>
<p><img src="fig/namu-wiki-viz-korea-1.png" style="display: block; margin: auto;" /></p>
<h2 id="시도별-지지율-변화">2. 시도별 지지율 변화</h2>
<p>전국적으로 정당별 지지율 변화를 살펴봤으면, 시도별 지지율 변화를 살펴보자. 갤럽조사에서 시도를 <code>인천/경기</code>, “대전/세종/충청”, “광주/전라”, “부산/울산/경남”와 같은 식으로 묶어 지지율도 다시 계산한다.</p>
<p>그리고 나서, 시도별로 조인하여 시각화한다.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>geometric.mean &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>  <span class="kw">exp</span>(<span class="kw">sum</span>(<span class="kw">log</span>(x[x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]), <span class="dt">na.rm=</span>na.rm) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(x))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>}</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="co"># 3. 데이터 병합 -------------------------------------</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>current_sido_df &lt;-<span class="st"> </span>gallop_df <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(시도 <span class="op">!=</span><span class="st"> &quot;전체&quot;</span>, 시도 <span class="op">!=</span><span class="st">&quot;강원&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(새시도=시도) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(정당, 정당지지율, <span class="op">-</span>새시도)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>past_sido_df &lt;-<span class="st"> </span>시도득표율_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(새시도 =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">recode</span>(시도, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>                               <span class="st">&quot;인천&quot;</span> =<span class="st"> &quot;인천/경기&quot;</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>                               <span class="st">&quot;경기&quot;</span> =<span class="st"> &quot;인천/경기&quot;</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>                               <span class="st">&quot;대전&quot;</span> =<span class="st"> &quot;대전/세종/충청&quot;</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>                               <span class="st">&quot;세종&quot;</span> =<span class="st"> &quot;대전/세종/충청&quot;</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a>                               <span class="st">&quot;충남&quot;</span> =<span class="st"> &quot;대전/세종/충청&quot;</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a>                               <span class="st">&quot;충북&quot;</span> =<span class="st"> &quot;대전/세종/충청&quot;</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a>                               <span class="st">&quot;광주&quot;</span> =<span class="st"> &quot;광주/전라&quot;</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a>                               <span class="st">&quot;전남&quot;</span> =<span class="st"> &quot;광주/전라&quot;</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a>                               <span class="st">&quot;전북&quot;</span> =<span class="st"> &quot;광주/전라&quot;</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a>                               <span class="st">&quot;대구&quot;</span> =<span class="st"> &quot;대구/경북&quot;</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a>                               <span class="st">&quot;경북&quot;</span> =<span class="st"> &quot;대구/경북&quot;</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a>                               <span class="st">&quot;부산&quot;</span> =<span class="st"> &quot;부산/울산/경남&quot;</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a>                               <span class="st">&quot;울산&quot;</span> =<span class="st"> &quot;부산/울산/경남&quot;</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a>                               <span class="st">&quot;경남&quot;</span> =<span class="st"> &quot;부산/울산/경남&quot;</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a>                               <span class="st">&quot;제주&quot;</span> =<span class="st"> &quot;제주&quot;</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true"></a>                               <span class="st">&quot;강원&quot;</span> =<span class="st"> &quot;강원&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(새시도) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(문재인 =<span class="st"> </span><span class="kw">geometric.mean</span>(문재인),</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true"></a>                   홍준표 =<span class="st"> </span><span class="kw">geometric.mean</span>(홍준표),</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true"></a>                   안철수 =<span class="st"> </span><span class="kw">geometric.mean</span>(안철수),</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true"></a>                   유승민 =<span class="st"> </span><span class="kw">geometric.mean</span>(유승민),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true"></a>                   심상정 =<span class="st"> </span><span class="kw">geometric.mean</span>(심상정)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(더불어민주당=문재인,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true"></a>                      자유한국당=홍준표,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true"></a>                      국민의당=안철수,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true"></a>                      바른정당=유승민,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true"></a>                      정의당=심상정) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(새시도 <span class="op">!=</span><span class="st"> &quot;강원&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(정당, 대선지지율, <span class="op">-</span>새시도) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(대선지지율 =<span class="st"> </span>대선지지율 <span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true"></a>시도지지율_df &lt;-<span class="st"> </span><span class="kw">inner_join</span>(past_sido_df, current_sido_df, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;정당&quot;</span>,<span class="st">&quot;새시도&quot;</span>))</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true"></a><span class="co"># 3. 시각화 -------------------------------------</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true"></a><span class="co">## 3.2. 경쟁적 배타관계 -------------------------------------</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true"></a>colors &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true"></a>시도지지율_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="st">`</span><span class="dt">대선지지율(5/9)</span><span class="st">`</span> =<span class="st"> </span>대선지지율, <span class="st">`</span><span class="dt">정당지지율(6/23)</span><span class="st">`</span> =<span class="st"> </span>정당지지율) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(정당 =<span class="st"> </span><span class="kw">factor</span>(정당, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;정의당&quot;</span>, <span class="st">&quot;바른정당&quot;</span>, <span class="st">&quot;국민의당&quot;</span>, <span class="st">&quot;자유한국당&quot;</span>, <span class="st">&quot;더불어민주당&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(대선전후, 지지율, <span class="op">-</span>정당, <span class="op">-</span>새시도) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data=</span>., <span class="kw">aes</span>(<span class="dt">x =</span> 정당, <span class="dt">y =</span> 지지율), <span class="dt">group=</span>새시도) <span class="op">+</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>대선전후, <span class="dt">shape=</span>대선전후), <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>새시도) <span class="op">+</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true"></a><span class="st">    </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true"></a><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true"></a><span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> party_color) <span class="op">+</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_family=</span><span class="st">&quot;NanumGothic&quot;</span>) <span class="op">+</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="op">+</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="fig/namu-wiki-viz-sido-1.png" style="display: block; margin: auto;" /></p>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
